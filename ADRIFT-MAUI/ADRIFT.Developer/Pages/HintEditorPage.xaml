<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:ADRIFT.Developer.ViewModels"
             x:Class="ADRIFT.Developer.Pages.HintEditorPage"
             x:DataType="vm:HintEditorViewModel"
             Title="Hint Editor">
    <Grid RowDefinitions="*,Auto">
        <!-- Main content -->
        <ScrollView Grid.Row="0">
            <VerticalStackLayout Padding="16" Spacing="16">
                <!-- Header -->
                <Frame BackgroundColor="{StaticResource ADRIFTPrimary}" Padding="16" Margin="0" CornerRadius="8">
                    <VerticalStackLayout Spacing="4">
                        <Label Text="{Binding PageTitle}" FontSize="20" FontAttributes="Bold" TextColor="White" />
                        <Label Text="{Binding HintCountText}" FontSize="14" TextColor="White" Opacity="0.9" />
                    </VerticalStackLayout>
                </Frame>

                <!-- Question Section -->
                <Frame Padding="16" BorderColor="{StaticResource ADRIFTSecondary}">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="Hint Question" FontSize="16" FontAttributes="Bold" />
                        <Entry Text="{Binding Question}" Placeholder="What should the hint help with?..." />
                        <Label Text="The question or topic that this hint addresses" FontSize="12" TextColor="Gray" />
                    </VerticalStackLayout>
                </Frame>

                <!-- Related Task Section -->
                <Frame Padding="16" BorderColor="{StaticResource ADRIFTSecondary}">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="Related Task (Optional)" FontSize="16" FontAttributes="Bold" />
                        <Picker Title="Select a task"
                                ItemsSource="{Binding AvailableTasks}"
                                ItemDisplayBinding="{Binding Name}"
                                SelectedItem="{Binding SelectedTask}" />
                        <Label Text="Optionally link this hint to a specific task" FontSize="12" TextColor="Gray" />
                    </VerticalStackLayout>
                </Frame>

                <!-- Hints Section -->
                <Frame Padding="16" BorderColor="{StaticResource ADRIFTSecondary}">
                    <VerticalStackLayout Spacing="12">
                        <HorizontalStackLayout Spacing="8">
                            <Label Text="Hints" FontSize="16" FontAttributes="Bold" VerticalOptions="Center" />
                            <Label Text="{Binding HintCountText}"
                                   FontSize="14"
                                   TextColor="{StaticResource ADRIFTPrimary}"
                                   VerticalOptions="Center" />
                        </HorizontalStackLayout>
                        <Label Text="Add hints in order from least to most helpful. Players will see them one at a time."
                               FontSize="12" TextColor="Gray" />

                        <!-- Add new hint -->
                        <VerticalStackLayout Spacing="8">
                            <Label Text="New Hint:" FontSize="14" FontAttributes="Bold" />
                            <Editor Text="{Binding NewHintText}"
                                    Placeholder="Enter a hint..."
                                    HeightRequest="80"
                                    AutoSize="TextChanges" />
                            <Button Text="Add Hint"
                                    Command="{Binding AddHintCommand}"
                                    BackgroundColor="{StaticResource ADRIFTSecondary}"
                                    HorizontalOptions="End" />
                        </VerticalStackLayout>

                        <!-- Hints list -->
                        <Label Text="No hints added yet"
                               IsVisible="{Binding HasNoHints}"
                               FontSize="14"
                               TextColor="Gray"
                               Margin="0,8" />

                        <CollectionView ItemsSource="{Binding Hints}"
                                        IsVisible="{Binding HasHints}"
                                        SelectionMode="None">
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="vm:HintItemViewModel">
                                    <SwipeView>
                                        <SwipeView.LeftItems>
                                            <SwipeItem Text="▲ Move Up"
                                                       BackgroundColor="{StaticResource ADRIFTSecondary}"
                                                       Command="{Binding Source={RelativeSource AncestorType={x:Type vm:HintEditorViewModel}}, Path=MoveHintUpCommand}"
                                                       CommandParameter="{Binding}" />
                                        </SwipeView.LeftItems>
                                        <SwipeView.RightItems>
                                            <SwipeItem Text="▼ Move Down"
                                                       BackgroundColor="{StaticResource ADRIFTSecondary}"
                                                       Command="{Binding Source={RelativeSource AncestorType={x:Type vm:HintEditorViewModel}}, Path=MoveHintDownCommand}"
                                                       CommandParameter="{Binding}" />
                                            <SwipeItem Text="Delete"
                                                       BackgroundColor="Red"
                                                       Command="{Binding Source={RelativeSource AncestorType={x:Type vm:HintEditorViewModel}}, Path=DeleteHintCommand}"
                                                       CommandParameter="{Binding}" />
                                        </SwipeView.RightItems>
                                        <Frame Padding="12" Margin="0,4" BorderColor="LightGray">
                                            <Grid RowDefinitions="Auto,*,Auto" ColumnDefinitions="Auto,*,Auto,Auto">
                                                <!-- Order number -->
                                                <Frame Grid.Row="0" Grid.RowSpan="2" Grid.Column="0"
                                                       BackgroundColor="{StaticResource ADRIFTPrimary}"
                                                       WidthRequest="40"
                                                       HeightRequest="40"
                                                       CornerRadius="20"
                                                       Padding="0"
                                                       VerticalOptions="Center"
                                                       Margin="0,0,12,0">
                                                    <Label Text="{Binding Order}"
                                                           FontSize="18"
                                                           FontAttributes="Bold"
                                                           TextColor="White"
                                                           HorizontalOptions="Center"
                                                           VerticalOptions="Center" />
                                                </Frame>

                                                <!-- Hint text -->
                                                <Label Grid.Row="0" Grid.RowSpan="2" Grid.Column="1"
                                                       Text="{Binding Text}"
                                                       FontSize="14"
                                                       VerticalOptions="Center"
                                                       Margin="0,0,8,0" />

                                                <!-- Move up button -->
                                                <Button Grid.Row="0" Grid.Column="2"
                                                        Text="▲"
                                                        FontSize="16"
                                                        WidthRequest="40"
                                                        HeightRequest="40"
                                                        BackgroundColor="{StaticResource ADRIFTSecondary}"
                                                        TextColor="White"
                                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:HintEditorViewModel}}, Path=MoveHintUpCommand}"
                                                        CommandParameter="{Binding}"
                                                        Margin="2" />

                                                <!-- Move down button -->
                                                <Button Grid.Row="1" Grid.Column="2"
                                                        Text="▼"
                                                        FontSize="16"
                                                        WidthRequest="40"
                                                        HeightRequest="40"
                                                        BackgroundColor="{StaticResource ADRIFTSecondary}"
                                                        TextColor="White"
                                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:HintEditorViewModel}}, Path=MoveHintDownCommand}"
                                                        CommandParameter="{Binding}"
                                                        Margin="2" />

                                                <!-- Delete button -->
                                                <Button Grid.Row="0" Grid.RowSpan="2" Grid.Column="3"
                                                        Text="×"
                                                        FontSize="20"
                                                        WidthRequest="40"
                                                        HeightRequest="80"
                                                        BackgroundColor="Red"
                                                        TextColor="White"
                                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:HintEditorViewModel}}, Path=DeleteHintCommand}"
                                                        CommandParameter="{Binding}"
                                                        Margin="2" />
                                            </Grid>
                                        </Frame>
                                    </SwipeView>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Frame>

                <!-- Examples Section -->
                <Frame Padding="16" BorderColor="{StaticResource ADRIFTSecondary}" BackgroundColor="#F0F8FF">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="Hint Ordering Example" FontSize="16" FontAttributes="Bold" />
                        <Label FontSize="12" TextColor="Gray">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="Question: " FontAttributes="Bold" />
                                    <Span Text="How do I get past the guard?" />
                                    <Span Text="&#10;&#10;1. " FontAttributes="Bold" />
                                    <Span Text="Try talking to the guard" FontAttributes="Italic" />
                                    <Span Text="&#10;2. " FontAttributes="Bold" />
                                    <Span Text="Maybe the guard wants something?" FontAttributes="Italic" />
                                    <Span Text="&#10;3. " FontAttributes="Bold" />
                                    <Span Text="Check your inventory for items the guard might like" FontAttributes="Italic" />
                                    <Span Text="&#10;4. " FontAttributes="Bold" />
                                    <Span Text="Give the guard the bottle of wine" FontAttributes="Italic" />
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                    </VerticalStackLayout>
                </Frame>
            </VerticalStackLayout>
        </ScrollView>

        <!-- Action buttons -->
        <Grid Grid.Row="1"
              ColumnDefinitions="*,Auto,Auto"
              Padding="16"
              BackgroundColor="{StaticResource ADRIFTLight}"
              ColumnSpacing="12">
            <Button Grid.Column="0"
                    Text="Cancel"
                    Command="{Binding CancelCommand}"
                    BackgroundColor="Gray" />
            <Button Grid.Column="1"
                    Text="Apply"
                    Command="{Binding ApplyCommand}"
                    BackgroundColor="{StaticResource ADRIFTSecondary}"
                    IsVisible="{Binding IsEditMode}" />
            <Button Grid.Column="2"
                    Text="OK"
                    Command="{Binding SaveAndCloseCommand}"
                    BackgroundColor="{StaticResource ADRIFTPrimary}" />
        </Grid>
    </Grid>
</ContentPage>
